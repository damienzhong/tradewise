<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>è·Ÿå•äº¤æ˜“ - TradeWise</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; }
        .container { margin-left: 200px; margin-top: 60px; padding: 32px; transition: margin-left 0.3s ease; }
        .container.sidebar-collapsed { margin-left: 0; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 24px; border-bottom: 2px solid #e0e0e0; }
        .tab { padding: 12px 24px; background: none; border: none; cursor: pointer; font-size: 16px; color: #666; transition: all 0.3s; border-bottom: 3px solid transparent; margin-bottom: -2px; }
        .tab:hover { color: #667eea; }
        .tab.active { color: #667eea; border-bottom-color: #667eea; font-weight: 600; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 24px; }
        .card h2 { margin-bottom: 20px; color: #333; display: flex; justify-content: space-between; align-items: center; }
        
        /* äº¤æ˜“å‘˜å¡ç‰‡æ ·å¼ */
        .trader-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .trader-card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #667eea; transition: all 0.3s; }
        .trader-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-2px); }
        .trader-header { display: flex; align-items: center; margin-bottom: 15px; }
        .trader-avatar { width: 60px; height: 60px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
        .trader-info h3 { margin: 0; font-size: 18px; color: #333; }
        .trader-info p { margin: 5px 0 0 0; font-size: 12px; color: #999; }
        .trader-stats { display: flex; gap: 15px; margin: 15px 0; }
        .stat-item { flex: 1; text-align: center; padding: 10px; background: #f5f7fa; border-radius: 6px; }
        .stat-item .label { font-size: 12px; color: #666; }
        .stat-item .value { font-size: 18px; font-weight: 600; color: #333; margin-top: 5px; }
        .trader-actions { display: flex; gap: 10px; }
        
        /* è®¢é˜…åˆ—è¡¨æ ·å¼ */
        .subscription-list { display: flex; flex-direction: column; gap: 15px; }
        .subscription-card { background: white; border-radius: 8px; padding: 20px; border: 1px solid #e0e0e0; border-left: 4px solid #28a745; transition: all 0.3s; }
        .subscription-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .sub-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        .sub-info { display: flex; align-items: center; flex: 1; }
        .trader-details h3 { margin: 0; font-size: 16px; color: #333; }
        .trader-details p { margin: 5px 0 0 0; font-size: 12px; color: #999; }
        .sub-stats { display: flex; gap: 15px; margin: 15px 0; }
        .stat-badge { padding: 6px 12px; background: #f5f7fa; border-radius: 6px; font-size: 12px; color: #666; }
        .sub-actions { display: flex; gap: 10px; align-items: center; }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #4caf50; }
        input:checked + .slider:before { transform: translateX(26px); }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; flex: 1; }
        .btn-secondary { background: #e0e0e0; color: #666; flex: 1; }
        .btn-danger { background: #f44336; color: white; }
        .btn:hover { opacity: 0.9; }
        
        .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
        .pagination button { padding: 8px 12px; border: 1px solid #e0e0e0; background: white; cursor: pointer; border-radius: 4px; }
        .pagination button.active { background: #667eea; color: white; border-color: #667eea; }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
    </style>
</head>
<body data-page="copy-trading">
    <div th:replace="user/components/tw-user-sidebar :: ~{}"></div>
    <div th:replace="user/components/tw-user-topbar :: ~{}"></div>
    
    <div class="container" id="mainContainer">
        <h1 style="margin-bottom: 24px; color: #333;">ğŸ“ˆ è·Ÿå•äº¤æ˜“</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('traders')">äº¤æ˜“å‘˜</button>
            <button class="tab" onclick="switchTab('subscriptions')">æˆ‘çš„è®¢é˜…</button>
            <button class="tab" onclick="switchTab('orders')">è®¢å•è®°å½•</button>
        </div>
        
        <!-- Tab 1: äº¤æ˜“å‘˜ -->
        <div id="traders-tab" class="tab-content active">
            <div class="card">
                <h2>æµè§ˆäº¤æ˜“å‘˜</h2>
                <div class="trader-grid" id="traderGrid">
                    <div style="text-align: center; padding: 40px; grid-column: 1/-1;">åŠ è½½ä¸­...</div>
                </div>
                <div class="pagination" id="traderPagination"></div>
            </div>
        </div>
        
        <!-- Tab 2: æˆ‘çš„è®¢é˜… -->
        <div id="subscriptions-tab" class="tab-content">
            <div class="card">
                <h2>è®¢é˜…åˆ—è¡¨</h2>
                <div class="subscription-list" id="subscriptionList">
                    <div style="text-align: center; padding: 40px; color: #999;">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <!-- Tab 3: è®¢å•è®°å½• -->
        <div id="orders-tab" class="tab-content">
            <div class="card">
                <h2>è®¢å•è®°å½•</h2>
                
                <!-- ç­›é€‰æ¡ä»¶ -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <select id="filterTraderId" class="btn" style="flex: 0 0 auto;">
                        <option value="">å…¨éƒ¨äº¤æ˜“å‘˜</option>
                    </select>
                    <input type="text" id="filterSymbol" placeholder="äº¤æ˜“å¯¹" class="btn" style="flex: 0 0 150px;">
                    <select id="filterSide" class="btn" style="flex: 0 0 auto;">
                        <option value="">å…¨éƒ¨æ–¹å‘</option>
                        <option value="BUY">ä¹°å…¥</option>
                        <option value="SELL">å–å‡º</option>
                    </select>
                    <input type="date" id="filterDate" class="btn" style="flex: 0 0 auto;">
                    <button class="btn btn-primary" onclick="loadOrders(1)" style="flex: 0 0 auto;">æœç´¢</button>
                    <button class="btn btn-secondary" onclick="resetFilters()" style="flex: 0 0 auto;">é‡ç½®</button>
                </div>
                
                <!-- è®¢å•åˆ—è¡¨ -->
                <div id="orderList" style="overflow-x: auto;">
                    <div style="text-align: center; padding: 40px; color: #999;">åŠ è½½ä¸­...</div>
                </div>
                
                <div class="pagination" id="orderPagination"></div>
            </div>
        </div>
    </div>
    
    <script>
        let currentTraderPage = 1;
        let currentOrderPage = 1;
        
        // Tabåˆ‡æ¢
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            if (tabName === 'traders' && !window.tradersLoaded) {
                loadTraders();
                window.tradersLoaded = true;
            } else if (tabName === 'subscriptions' && !window.subscriptionsLoaded) {
                loadSubscriptions();
                window.subscriptionsLoaded = true;
            } else if (tabName === 'orders' && !window.ordersLoaded) {
                loadTraderOptions();
                loadOrders();
                window.ordersLoaded = true;
            }
        }
        
        // åŠ è½½äº¤æ˜“å‘˜
        async function loadTraders(page = 1) {
            const res = await fetch(`/user/subscriptions/traders?page=${page}&size=12`);
            const data = await res.json();
            if (data.success) {
                renderTraders(data.traders);
                renderTraderPagination(data.page, data.totalPages);
                currentTraderPage = page;
            }
        }
        
        function renderTraders(traders) {
            const grid = document.getElementById('traderGrid');
            if (traders.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px; grid-column: 1/-1; color: #999;">æš‚æ— äº¤æ˜“å‘˜</div>';
                return;
            }
            grid.innerHTML = traders.map(t => `
                <div class="trader-card">
                    <div class="trader-header">
                        <img src="${t.avatarUrl || '/images/default-avatar.png'}" class="trader-avatar" alt="${t.traderName}">
                        <div class="trader-info">
                            <h3>${t.traderName}</h3>
                            <p>${t.description || 'æš‚æ— æè¿°'}</p>
                        </div>
                    </div>
                    <div class="trader-stats">
                        <div class="stat-item">
                            <div class="label">ç´¯è®¡è®¢å•</div>
                            <div class="value">${t.totalOrders || 0}</div>
                        </div>
                        <div class="stat-item">
                            <div class="label">ä»Šæ—¥è®¢å•</div>
                            <div class="value">${t.todayOrders || 0}</div>
                        </div>
                    </div>
                    <div class="trader-actions">
                        ${t.subscribed ? 
                            `<button class="btn btn-secondary" onclick="unsubscribe(${t.id})">å·²è®¢é˜…</button>` :
                            `<button class="btn btn-primary" onclick="subscribe(${t.id})">è®¢é˜…</button>`
                        }
                    </div>
                </div>
            `).join('');
        }
        
        function renderTraderPagination(current, total) {
            const pagination = document.getElementById('traderPagination');
            let html = `<button onclick="loadTraders(${current - 1})" ${current === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;
            for (let i = 1; i <= total; i++) {
                if (i === 1 || i === total || (i >= current - 2 && i <= current + 2)) {
                    html += `<button class="${i === current ? 'active' : ''}" onclick="loadTraders(${i})">${i}</button>`;
                }
            }
            html += `<button onclick="loadTraders(${current + 1})" ${current === total ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
            pagination.innerHTML = html;
        }
        
        async function subscribe(traderId) {
            const res = await fetch(`/user/subscriptions/subscribe/${traderId}`, { method: 'POST' });
            const data = await res.json();
            alert(data.message || (data.success ? 'è®¢é˜…æˆåŠŸï¼' : 'è®¢é˜…å¤±è´¥'));
            if (data.success) {
                loadTraders(currentTraderPage);
                window.subscriptionsLoaded = false;
            }
        }
        
        async function unsubscribe(traderId) {
            if (!confirm('ç¡®å®šè¦å–æ¶ˆè®¢é˜…å—ï¼Ÿ')) return;
            const res = await fetch(`/user/subscriptions/unsubscribe/${traderId}`, { method: 'DELETE' });
            const data = await res.json();
            alert(data.message || (data.success ? 'å–æ¶ˆè®¢é˜…æˆåŠŸï¼' : 'å–æ¶ˆè®¢é˜…å¤±è´¥'));
            if (data.success) {
                loadTraders(currentTraderPage);
                window.subscriptionsLoaded = false;
            }
        }
        
        // åŠ è½½è®¢é˜…åˆ—è¡¨
        async function loadSubscriptions() {
            const res = await fetch('/user/subscriptions/my');
            const data = await res.json();
            if (data.success) renderSubscriptions(data.subscriptions);
        }
        
        function renderSubscriptions(subscriptions) {
            const list = document.getElementById('subscriptionList');
            if (subscriptions.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px;">ğŸ“­</div>
                        <p>æ‚¨è¿˜æ²¡æœ‰è®¢é˜…ä»»ä½•äº¤æ˜“å‘˜</p>
                        <button class="btn btn-primary" style="margin-top: 15px;" onclick="switchTab('traders'); document.querySelectorAll('.tab')[0].click();">å»è®¢é˜…</button>
                    </div>
                `;
                return;
            }
            list.innerHTML = subscriptions.map(sub => `
                <div class="subscription-card">
                    <div class="sub-header">
                        <div class="sub-info">
                            <img src="${sub.avatarUrl || '/images/default-avatar.png'}" class="trader-avatar" style="width: 50px; height: 50px;" alt="${sub.traderName}">
                            <div class="trader-details">
                                <h3>${sub.traderName}</h3>
                                <p>${sub.description || 'æš‚æ— æè¿°'}</p>
                            </div>
                        </div>
                        <div class="sub-actions">
                            <label style="font-size: 12px; color: #666; margin-right: 10px;">
                                é‚®ä»¶é€šçŸ¥
                                <label class="switch" style="margin-left: 8px;">
                                    <input type="checkbox" ${sub.notifyEmail ? 'checked' : ''} onchange="toggleNotify(${sub.traderId}, this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </label>
                            <button class="btn btn-danger" onclick="unsubscribeFromList(${sub.traderId})">å–æ¶ˆè®¢é˜…</button>
                        </div>
                    </div>
                    <div class="sub-stats">
                        <span class="stat-badge">ğŸ“Š ç´¯è®¡è®¢å•: ${sub.totalOrders || 0}</span>
                        <span class="stat-badge">ğŸ“… ä»Šæ—¥è®¢å•: ${sub.todayOrders || 0}</span>
                        <span class="stat-badge">ğŸ• è®¢é˜…æ—¶é—´: ${formatDate(sub.subscribedAt)}</span>
                    </div>
                </div>
            `).join('');
        }
        
        async function toggleNotify(traderId, enabled) {
            const res = await fetch(`/user/subscriptions/update/${traderId}?notifyEmail=${enabled}&status=ACTIVE`, { method: 'PUT' });
            const data = await res.json();
            if (!data.success) {
                alert(data.message || 'æ›´æ–°å¤±è´¥');
                loadSubscriptions();
            }
        }
        
        async function unsubscribeFromList(traderId) {
            if (!confirm('ç¡®å®šè¦å–æ¶ˆè®¢é˜…å—ï¼Ÿå–æ¶ˆåå°†ä¸å†æ”¶åˆ°è¯¥äº¤æ˜“å‘˜çš„è®¢å•é€šçŸ¥ã€‚')) return;
            const res = await fetch(`/user/subscriptions/unsubscribe/${traderId}`, { method: 'DELETE' });
            const data = await res.json();
            alert(data.message || (data.success ? 'å–æ¶ˆè®¢é˜…æˆåŠŸï¼' : 'å–æ¶ˆè®¢é˜…å¤±è´¥'));
            if (data.success) {
                loadSubscriptions();
                window.tradersLoaded = false;
            }
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('zh-CN');
        }
        
        // è®¢å•è®°å½•åŠŸèƒ½
        async function loadTraderOptions() {
            const res = await fetch('/user/subscriptions/my');
            const data = await res.json();
            if (data.success) {
                const select = document.getElementById('filterTraderId');
                select.innerHTML = '<option value="">å…¨éƒ¨äº¤æ˜“å‘˜</option>' + 
                    data.subscriptions.map(s => `<option value="${s.traderId}">${s.traderName}</option>`).join('');
            }
        }
        
        async function loadOrders(page = 1) {
            const traderId = document.getElementById('filterTraderId').value;
            const symbol = document.getElementById('filterSymbol').value;
            const side = document.getElementById('filterSide').value;
            const date = document.getElementById('filterDate').value;
            
            let url = `/user/orders/list?page=${page}&size=10`;
            if (traderId) url += `&traderId=${traderId}`;
            if (symbol) url += `&symbol=${symbol}`;
            if (side) url += `&side=${side}`;
            if (date) url += `&date=${date}`;
            
            const res = await fetch(url);
            const data = await res.json();
            if (data.success) {
                renderOrders(data.orders);
                renderOrderPagination(data.page, data.totalPages);
                currentOrderPage = page;
            } else {
                document.getElementById('orderList').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #f44336;">${data.message || 'åŠ è½½å¤±è´¥'}</div>
                `;
            }
        }
        
        function renderOrders(orders) {
            const list = document.getElementById('orderList');
            if (orders.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px;">ğŸ“‹</div>
                        <p>æš‚æ— è®¢å•è®°å½•</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f5f7fa; border-bottom: 2px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left;">ID</th>
                            <th style="padding: 12px; text-align: left;">äº¤æ˜“å‘˜</th>
                            <th style="padding: 12px; text-align: left;">äº¤æ˜“å¯¹</th>
                            <th style="padding: 12px; text-align: left;">æ“ä½œç±»å‹</th>
                            <th style="padding: 12px; text-align: right;">å‡ä»· (USDT)</th>
                            <th style="padding: 12px; text-align: right;">æˆäº¤æ•°é‡</th>
                            <th style="padding: 12px; text-align: right;">æ€»ä»·å€¼ (USDT)</th>
                            <th style="padding: 12px; text-align: right;">å·²å®ç°ç›ˆäº (USDT)</th>
                            <th style="padding: 12px; text-align: left;">è®¢å•æ—¶é—´</th>
                            <th style="padding: 12px; text-align: center;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${orders.map(order => `
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px;">${order.id}</td>
                                <td style="padding: 12px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <img src="${order.avatarUrl || '/images/default-avatar.png'}" style="width: 32px; height: 32px; border-radius: 50%;" alt="${order.traderName}">
                                        <span>${order.traderName || '-'}</span>
                                    </div>
                                </td>
                                <td style="padding: 12px; font-weight: 600;">${order.symbol}</td>
                                <td style="padding: 12px;">
                                    <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; 
                                        background: ${getActionTypeBg(order.actionType)}; 
                                        color: white;">
                                        ${order.actionType}
                                    </span>
                                </td>
                                <td style="padding: 12px; text-align: right; font-family: monospace;">${order.avgPrice ? parseFloat(order.avgPrice).toFixed(4) : '-'}</td>
                                <td style="padding: 12px; text-align: right; font-family: monospace;">${order.executedQty ? parseFloat(order.executedQty).toFixed(4) : '-'}</td>
                                <td style="padding: 12px; text-align: right; font-family: monospace;">${order.totalValue ? parseFloat(order.totalValue).toFixed(2) : '-'}</td>
                                <td style="padding: 12px; text-align: right; font-family: monospace; color: ${getPnlColor(order.realizedPnl)};">
                                    ${order.realizedPnl ? parseFloat(order.realizedPnl).toFixed(2) : '-'}
                                </td>
                                <td style="padding: 12px; font-size: 12px; color: #666;">${formatDateTime(order.orderTime)}</td>
                                <td style="padding: 12px; text-align: center;">
                                    <button class="btn btn-primary" style="padding: 4px 12px; font-size: 12px;" onclick="viewOrderDetail(${order.id})">
                                        æŸ¥çœ‹è¯¦æƒ…
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function renderOrderPagination(current, total) {
            const pagination = document.getElementById('orderPagination');
            if (total <= 1) {
                pagination.innerHTML = '';
                return;
            }
            let html = `<button onclick="loadOrders(${current - 1})" ${current === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;
            for (let i = 1; i <= total; i++) {
                if (i === 1 || i === total || (i >= current - 2 && i <= current + 2)) {
                    html += `<button class="${i === current ? 'active' : ''}" onclick="loadOrders(${i})">${i}</button>`;
                }
            }
            html += `<button onclick="loadOrders(${current + 1})" ${current === total ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
            pagination.innerHTML = html;
        }
        
        function resetFilters() {
            document.getElementById('filterTraderId').value = '';
            document.getElementById('filterSymbol').value = '';
            document.getElementById('filterSide').value = '';
            document.getElementById('filterDate').value = '';
            loadOrders(1);
        }
        
        function getActionTypeText(actionType) {
            const map = {
                'OPEN': 'å¼€ä»“',
                'CLOSE': 'å¹³ä»“',
                'ADD': 'åŠ ä»“',
                'REDUCE': 'å‡ä»“'
            };
            return map[actionType] || actionType;
        }
        
        function getActionTypeBg(actionType) {
            if (actionType.includes('å¼€å¤š') || actionType.includes('å¹³ç©º')) return '#4caf50';
            if (actionType.includes('å¼€ç©º') || actionType.includes('å¹³å¤š')) return '#f44336';
            return '#666';
        }
        
        function getPnlColor(pnl) {
            if (!pnl) return '#666';
            return parseFloat(pnl) > 0 ? '#4caf50' : parseFloat(pnl) < 0 ? '#f44336' : '#666';
        }
        
        async function viewOrderDetail(orderId) {
            const res = await fetch(`/user/orders/detail/${orderId}`);
            const data = await res.json();
            if (data.success) {
                showOrderDetailModal(data.order);
            } else {
                alert(data.message || 'åŠ è½½è¯¦æƒ…å¤±è´¥');
            }
        }
        
        function showOrderDetailModal(order) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999;';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">è®¢å•è¯¦æƒ…</h3>
                        <button onclick="this.closest('div[style*=fixed]').remove()" style="border: none; background: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
                    </div>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">è®¢å•ID</th>
                            <td style="padding: 12px;">${order.orderId}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">äº¤æ˜“å‘˜</th>
                            <td style="padding: 12px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <img src="${order.avatarUrl || '/images/default-avatar.png'}" style="width: 32px; height: 32px; border-radius: 50%;" alt="${order.traderName}">
                                    <span>${order.traderName}</span>
                                </div>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">äº¤æ˜“å¯¹</th>
                            <td style="padding: 12px; font-weight: 600;">${order.symbol}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">æ“ä½œç±»å‹</th>
                            <td style="padding: 12px;">
                                <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; 
                                    background: ${getActionTypeBg(order.actionType)}; color: white;">
                                    ${order.actionType}
                                </span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">å‡ä»·</th>
                            <td style="padding: 12px; font-family: monospace;">${order.avgPrice ? parseFloat(order.avgPrice).toFixed(4) : '-'} USDT</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">æˆäº¤æ•°é‡</th>
                            <td style="padding: 12px; font-family: monospace;">${order.executedQty ? parseFloat(order.executedQty).toFixed(4) : '-'}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">æ€»ä»·å€¼</th>
                            <td style="padding: 12px; font-family: monospace;">${order.totalValue ? parseFloat(order.totalValue).toFixed(2) : '-'} USDT</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">å·²å®ç°ç›ˆäº</th>
                            <td style="padding: 12px; font-family: monospace; color: ${getPnlColor(order.realizedPnl)};">
                                ${order.realizedPnl ? parseFloat(order.realizedPnl).toFixed(2) + ' USDT' : '-'}
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">è®¢å•æ—¶é—´</th>
                            <td style="padding: 12px;">${formatDateTime(order.orderTime)}</td>
                        </tr>
                        <tr>
                            <th style="padding: 12px; text-align: left; color: #666; font-weight: 500;">æ›´æ–°æ—¶é—´</th>
                            <td style="padding: 12px;">${formatDateTime(order.updateTime)}</td>
                        </tr>
                    </table>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function formatDateTime(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleString('zh-CN', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // åˆå§‹åŠ è½½
        loadTraders();
        window.tradersLoaded = true;
    </script>
    <script th:replace="user/components/tw-user-common-script :: ~{}"></script>
</body>
</html>
